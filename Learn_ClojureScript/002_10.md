[UP](002_00.md)


### レッスン10：選択肢を作る

これまで私たちが書いてきたコードは、ある出発点から始まり、完成するまで進行するものがほとんどでした(*1)。コードには明確に定義されたタスクがあり、そのタスクを達成するためには、明確に定義された一連の命令に従わなければなりません。しかし、私たちに欠けていたのは、何らかの条件に応じて別の道を歩むことができるという「選択」の概念です。例えば、何百キロも続く、他の道と交わることのない道があったとします。その道を車で走るとしたら、別の道を通るかどうかを決める必要がないので楽ですが、その分、退屈なドライブになってしまいます。私たちが書くコードも同じです。上から下に向かって走るだけの、はっきりとした直線的な実行をするスクリプトを書くこともできますが、そうすると、最も面白くてやりがいのあるプログラムを見逃してしまうことになります。

-----
このレッスンでは

- 単純な選択をするために、`if`と`when`を適用する
- 真偽の概念とその定義に慣れる
- `cond`を使って複数の選択肢から選ぶ
-----

#### 例 アドベンチャーゲーム

![Starbase Lambda](imgs2/adventure-screenshot.png)
テキストベースのアドベンチャーゲーム

このレッスンでは、テキストベースのシンプルなアドベンチャーゲームを作ります。アドベンチャーゲームは、仮想環境の中でユーザーに一連の選択をさせることで成り立っているので、条件分岐の概念を学ぶのに最適なゲームです。一度に一つのブロックを学ぶことに集中できるように、著者の端末エミュレータライブラリ[bterm](https://github.com/kendru/bterm)を使用します。これにより、DOM操作やイベント処理、大規模なフレームワークを学ぶことなく、制御構造の中核となる概念に集中することができます。

#### ifとwhenで簡単な選択をする

私たちが何かを選択するときには、通常、何かが真か偽かを判断する必要があります。例えば、特定のチェックボックスが選択されているか？アカウントの残高がある閾値を下回っているか？プレイヤーがインベントリに特定のポーションを持っているか？このような質問には、"yes "か "no "の2つの答えのどちらかしかありません。ClojureScriptは式を評価して動作しますので、これらの質問は通常、真か偽のどちらかに評価される式の形をしています。上記の質問がClojureScriptの式に変換されたものを想像してみましょう。

```Clojure
;; チェックボックスにチェックが入っているか？
(aget my-checkbox "checked")

;; アカウントの残高が閾値を下回っているか？
(< (:balance account) low-balance-threshold)

;; プレイヤーは在庫に知恵の薬を持っていますか？
(some #(= (:name %) "Potion of Wisdom")
      (get-inventory player))
```      
質問をする式

これらの式を評価すると（参照している変数が実際に定義されていると仮定して）、その値は真か偽のどちらかであると考えられるものになります。

##### ifによる選択

答えが真のときにはある選択をし、答えが偽のときには別の選択をしたいことがよくあります。このような場合には、ClojureScriptの`if`特殊形式を使用することができます。if式は次のような形をしています。

```Clojure
(if test-expr then-expr else-expr)
```

`if`は、「テスト」と、「テストが真の場合に使用する値」と、「テストが偽の場合に使用する値」の3つの式を取ります。`if`式全体の評価は、最初の式の値に応じて、2番目または3番目の式の値になります。先ほどの口座残高の例を使うと、次のように書くことができます。

```Clojure
(def account-status
  (if (< (:balance account) low-balance-threshold)         ;; <1>
    :low-balance                                           ;; <2>
    :ok))                                                  ;; <3>
```
1. バランスがあるポイントを下回っているかどうかをテストする
2. テストが真であれば `:low-balance` と評価する。
3. このテストが偽の場合、 `:ok` と評価します。

> NOTE: 特殊形式
>
> S式を書くと、ClojureScriptは式の最初のシンボルが関数名、マクロ名、または特殊形式に解決される限り、それを評価します。`if`の呼び出しは関数の呼び出しのように見えますが、`if`は実際には関数ではなく特別な形式です。私たちはこれまでしばらくの間、関数を書いてきましたし、後のレッスンではマクロの書き方を学びますが、特殊形式が言語に焼き付けられているのは、ライブラリ関数としては実装できないほど基本的なものだからです（少なくとも効率的ではありません）。ありがたいことに、開発者としての私たちの視点では、呼び出している特定のものが、関数、マクロ、特殊形式のどれであるかを気にする必要はありません。

`if`文の考え方は開発者なら誰でも知っているはずですが、ほとんどの言語の`if`文とClojureScriptの`if`には重要な違いがあります。ClojureScriptでは`if`は式なので、常に特定の値で評価されます。JavaScriptのような命令型言語では、`if`文は通常、どのコードブランチを実行するかの選択を行います。実際の`if`文では、値は得られません。例えば、次のようなものは有効なJavaScriptではありません。

```JavaScript
// This will throw a SyntaxError
const answer = if (someCondition) {
   'Yes';
} else {
   'No';
}
```
JavaScript のIFは式ではない

しかし、JavaScriptには式である三項演算子が用意されています。ClojureScriptの`if`式は、JavaScriptの三項演算子と非常によく似ていますが、扱うべき構文が一つ減りました!












[UP](002_00.md)
